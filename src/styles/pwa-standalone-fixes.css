/* 
  PWA STANDALONE MODE FIXES
  These rules handle layout issues when the app is saved to home screen
  and runs in standalone/fullscreen mode
*/

@media all and (display-mode: standalone) {
  /* CRITICAL: Ensure app uses full screen height */
  html, body, #root {
    height: 100vh !important;
    height: calc(var(--vh, 1vh) * 100) !important;
    min-height: 100vh !important;
    padding: 0 !important;
    margin: 0 !important;
  }

  /* Move top controls higher - another 5px higher */
  .top-left-style-selector, .header-style-select, .global-style-btn {
    top: max(10px, env(safe-area-inset-top)) !important;
  }

  .header-settings-btn {
    top: max(10px, env(safe-area-inset-top)) !important;
  }

  .header-info-btn {
    top: max(10px, env(safe-area-inset-top)) !important;
  }

  /* Fix bottom navigation buttons - align to actual bottom */
  .back-to-menu-btn {
    bottom: max(5px, env(safe-area-inset-bottom)) !important;
    left: max(20px, env(safe-area-inset-left) + 5px) !important;
  }

  .view-photos-btn {
    bottom: max(5px, env(safe-area-inset-bottom)) !important;
    right: max(20px, env(safe-area-inset-right) + 5px) !important;
  }

  /* Fix photo grid to use full available space with proper scroll behavior */
  .film-strip-container {
    /* Ensure smooth scrolling on iOS */
    -webkit-overflow-scrolling: touch !important;
    overflow-y: auto !important;
    overflow-x: hidden !important;
    overscroll-behavior: contain !important;
    /* Remove transform that breaks scrolling */
    transform: none !important;
    will-change: auto !important;
    /* Ensure container takes full height */
    height: 100vh !important;
    height: calc(var(--vh, 1vh) * 100) !important;
  }

  .film-strip-content {
    /* Keep the original grid layout - don't override it */
    padding-top: max(70px, env(safe-area-inset-top) + 60px) !important;
    padding-bottom: max(120px, env(safe-area-inset-bottom) + 100px) !important;
    /* Remove min-height and contain that break the grid */
  }

  /* Fix photo grid animations in PWA mode */
  .film-frame.loading:not(.selected):not(.newly-arrived) {
    /* Disable complex animations that cause issues in PWA */
    animation: none !important;
    transition: opacity 0.3s ease !important;
  }

  /* Simplify loading placeholder animations for PWA */
  .film-frame.loading .placeholder {
    animation: simple-fade-in 0.5s ease forwards !important;
  }

  @keyframes simple-fade-in {
    from { opacity: 0.1; }
    to { opacity: 0.3; }
  }

  /* CAMERA POSITIONING - Adjust to better position (reduce from 300px) */
  [class*="cameraContainer"] {
    align-items: flex-start !important;
    justify-content: center !important;
    padding-top: max(180px, env(safe-area-inset-top) + 160px) !important;
    padding-bottom: max(40px, env(safe-area-inset-bottom) + 30px) !important;
  }

  /* Remove conflicting polaroid frame margins */
  [class*="polaroidFrame"] {
    margin-top: 0 !important;
    margin-bottom: 0 !important;
  }

  /* Position camera buttons EVEN LOWER - 0.66x more down from 5px */
  [class*="bottomControls"] {
    bottom: 13px !important;
  }

  /* Fix image adjuster overlay to cover full screen */
  .image-adjuster-overlay {
    height: 100vh !important;
    height: calc(var(--vh, 1vh) * 100) !important;
    top: 0 !important;
    bottom: 0 !important;
  }

  /* START MENU OVERLAY - REMOVED ALL GARBAGE CSS THAT DOESN'T WORK */
  /* Keeping it ugly since none of the fixes work */

  /* Fix Advanced Settings overlay - AGGRESSIVE OVERRIDE */
  .control-overlay,
  :global(.control-overlay),
  body .control-overlay,
  html body .control-overlay {
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    right: 0 !important;
    bottom: 0 !important;
    width: 100vw !important;
    height: 100vh !important;
    height: calc(var(--vh, 1vh) * 100) !important;
    min-height: 100vh !important;
    min-height: calc(var(--vh, 1vh) * 100) !important;
    max-height: none !important;
    padding: 0 !important;
    overflow-y: auto !important;
    z-index: 99999 !important;
    transform: translateY(0) !important;
  }

  /* Fix Advanced Settings content container - AGGRESSIVE OVERRIDE */
  .control-overlay-content,
  :global(.control-overlay-content),
  body .control-overlay-content,
  html body .control-overlay-content {
    padding-top: max(60px, env(safe-area-inset-top) + 50px) !important;
    padding-bottom: max(60px, env(safe-area-inset-bottom) + 50px) !important;
    min-height: 100vh !important;
    min-height: calc(var(--vh, 1vh) * 100) !important;
    height: auto !important;
    max-width: none !important;
    margin: 0 !important;
    box-sizing: border-box !important;
  }

  /* Fix Advanced Settings close button positioning - TOP RIGHT CORNER */
  .dismiss-overlay-btn {
    position: fixed !important;
    top: max(20px, env(safe-area-inset-top) + 10px) !important;
    right: max(20px, env(safe-area-inset-right) + 10px) !important;
    z-index: 99999 !important;
  }

  /* Fix Twitter modal close button */
  .twitter-modal-close {
    top: max(12px, env(safe-area-inset-top) + 8px) !important;
    right: max(12px, env(safe-area-inset-right) + 8px) !important;
  }

  /* Fix photo close button positioning - move down from status bar */
  .photo-close-btn {
    top: max(60px, env(safe-area-inset-top) + 50px) !important;
    right: max(20px, env(safe-area-inset-right) + 10px) !important;
    /* Ensure it's in a touchable area */
    min-width: 44px !important;
    min-height: 44px !important;
    width: 44px !important;
    height: 44px !important;
    /* Make it more visible */
    background: rgba(0, 0, 0, 0.8) !important;
    backdrop-filter: blur(10px) !important;
  }

  /* Fix photo action buttons positioning in PWA mode */
  .photo-action-buttons {
    bottom: max(30px, env(safe-area-inset-bottom) + 20px) !important;
    padding: 0 max(20px, env(safe-area-inset-left) + 10px) max(0px, env(safe-area-inset-right) + 10px) !important;
  }

  /* Ensure action buttons are properly sized for touch */
  .action-button {
    min-height: 44px !important;
    padding: 12px 16px !important;
    font-size: 14px !important;
  }

  /* Fix other modal close buttons */
  .modal [class*="close"], .modal .close-btn, [class*="modal"] [class*="close"] {
    top: max(16px, env(safe-area-inset-top) + 8px) !important;
    right: max(16px, env(safe-area-inset-right) + 8px) !important;
  }

  /* Fix photo navigation buttons in PWA mode */
  .photo-nav-btn {
    top: 50% !important;
    transform: translateY(-50%) !important;
    min-width: 44px !important;
    min-height: 44px !important;
    /* Ensure buttons are visible and properly styled */
    background: rgba(255, 255, 255, 0.9) !important;
    color: #FF69B4 !important;
    border: 2px solid #FF69B4 !important;
    width: 60px !important;
    height: 60px !important;
    border-radius: 50% !important;
    font-size: 48px !important;
    display: flex !important;
    justify-content: center !important;
    align-items: center !important;
    cursor: pointer !important;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3) !important;
    transition: all 0.2s ease !important;
  }

  .photo-nav-btn.prev {
    left: max(20px, env(safe-area-inset-left) + 10px) !important;
  }

  .photo-nav-btn.next {
    right: max(20px, env(safe-area-inset-right) + 10px) !important;
  }

  /* Override the mobile negative positioning specifically in PWA mode */
  .film-strip-container.pwa-mode.has-selected .photo-nav-btn.prev {
    left: max(20px, env(safe-area-inset-left) + 10px) !important;
    position: fixed !important;
  }

  .film-strip-container.pwa-mode.has-selected .photo-nav-btn.next {
    right: max(20px, env(safe-area-inset-right) + 10px) !important;
    position: fixed !important;
  }

  /* Ensure navigation buttons work on hover/active in PWA */
  .photo-nav-btn:hover {
    background: rgba(255, 255, 255, 1) !important;
    transform: translateY(-50%) scale(1.1) !important;
    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.4) !important;
  }

  .photo-nav-btn:active {
    background: rgba(255, 255, 255, 1) !important;
    transform: translateY(-50%) scale(1.3) !important;
  }

  /* Fix selected photo z-index - ensure it's above overlay */
  body .film-frame.selected.loaded,
  body .film-frame.selected,
  .film-frame.selected {
    z-index: 999999 !important;
    /* Ensure selected photo is above any overlays including the dark background */
    position: fixed !important;
  }

  /* Ensure the dark overlay doesn't cover the selected photo */
  .film-strip-container.has-selected::before {
    z-index: 9990 !important;
    /* Keep overlay below selected photo */
  }

  /* Ensure photo action buttons are above selected photo */
  .photo-action-buttons {
    z-index: 999999 !important;
  }

  /* Ensure navigation buttons are above selected photo */
  .photo-nav-btn {
    z-index: 999999 !important;
  }

  /* Ensure close button is above selected photo */
  .photo-close-btn {
    z-index: 999999 !important;
  }

  /* PWA-specific optimizations */
  .film-strip-container.pwa-mode {
    /* Remove contain that breaks layout */
    will-change: auto !important;
  }

  .film-strip-container.pwa-mode .film-frame.loading {
    /* Simplified loading states for better PWA performance */
    transition: opacity 0.3s ease !important;
  }

  .film-strip-container.pwa-mode .film-frame.loading .placeholder {
    /* Disable complex animations in PWA mode */
    animation: simple-fade-in 0.5s ease forwards !important;
  }
}
